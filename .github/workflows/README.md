# 画像最適化ワークフロー

このディレクトリには、PR時に画像ファイルの圧縮可能性をチェックし、最適化された画像を含む新しいPRを自動作成するGitHub Actionsワークフローが含まれています。

## ワークフローの概要

`image-optimization.yml`は以下の処理を行います：

1. PRの差分から画像ファイル（JPEG、PNG）を抽出
2. ファイル形式に応じた圧縮ツールを使用して圧縮テスト
   - JPEGの場合: `jpegoptim`
   - PNGの場合: `pngquant`
3. 圧縮前後のファイルサイズを比較
4. 圧縮後のサイズが元のサイズの70%以下になる場合:
   - 最適化された画像を含む新しいPRを自動作成
   - 元のPRにコメントを追加（最適化PRへのリンクを含む）
   - CIをFailにする

## 技術的な詳細

- トリガー条件: PRが作成または更新された時
- 使用環境: ubuntu-latest
- 必要な権限:
  - `contents: write`: リポジトリのコンテンツ変更とブランチ作成
  - `pull-requests: write`: PRの作成とコメント追加
- 使用ツール:
  - jpegoptim: JPEG圧縮用
  - pngquant: PNG圧縮用
  - gh CLI: PR作成用

## 処理フロー

1. **画像圧縮チェック**: 画像を検出し、圧縮率をチェック
2. **PRの作成**: 圧縮された画像を新ブランチにコミットし、PRを作成
3. **コメントの追加**: 元のPRに、最適化PRへのリンクを含むコメントを追加

## カスタマイズ方法

圧縮の閾値やパラメータを変更する場合は、`image-optimization.yml`ファイル内の以下の箇所を編集してください：

- JPEG圧縮率の変更: `jpegoptim --max=80` の数値を調整
- PNG圧縮品質の変更: `pngquant --quality=65-80` の数値を調整
- サイズ削減率の閾値変更: `if (( $(echo "$REDUCTION > 30" | bc -l) ));` の `30` を変更
